# Spot Greek Exposure by Strike
This python script demonstrates a technique for fetching and storing spot greeks (delta, gamma, vanna, charm) for multiple tickers and strike ranges on a scheduled cadence, allowing you to track changes throughout the trading day. Notable sections of `spot_greek_exposure_by_strike.py`:
- Select securities and strike ranges (lines 26-31), default is `SPXW`, `SPY`, `AAPL`, and `TSLA`
- Set your update frequency (line 356), default is once per minute

### Notes
- `floatify()`: convenience function that converts eligible types to float
- `setup_logging()`: creates and configures the `logger`
- `async create_database_table()`: creates the SQLite table "spot_greek_exposure_by_strike"
- `async fetch_data_and_write_to_db()`: the key function that fetches the spot greeks by strike data from the Unusual Whales API and writes it to the SQLite database
- `async main()`: the main loop

### Quick Database Exploration
You must run the script at least once to have records stored in the SQLite database. Even if the script is running during the day, you can still interact with the SQLite database by connecting to it via terminal:
```
sqlite3 spot_greek_exposure_by_strike.db
```

Now that you are in the SQLite terminal user interface ("TUI"), turn on headers and column mode for pretty printing:
```
sqlite> .headers on
sqlite> .mode column
```

This is a small database created by running the script for roughly 40 minutes on Wednesday 2025-10-22, but since the selected tickers have so many strikes and the script is fetching the latest data every minute we can see that there are quite a few records in the database:
```
sqlite> SELECT COUNT(*) FROM spot_greek_exposure_by_strike;
COUNT(*)
--------
48792
```

The response data from the Spot Greek Exposure by Strike endpoint is very thorough:
- Docs: [https://api.unusualwhales.com/docs#/operations/PublicApi.TickerController.spot_exposures_by_strike](https://api.unusualwhales.com/docs#/operations/PublicApi.TickerController.spot_exposures_by_strike)
- GET: `https://api.unusualwhales.com/api/stock/{ticker}/spot-exposures/strike`

Let's explore a much smaller subset of the data by checking out the spot gamma exposure around `TSLA` which was trading near $430 per share:
```
sqlite> SELECT api_access_datetime, time, strike, call_gamma_oi, call_gamma_vol, put_gamma_oi, put_gamma_vol
   ...> FROM spot_greek_exposure_by_strike
   ...> WHERE ticker='TSLA' AND strike>=410 AND strike<=450
   ...> ORDER BY time ASC, strike ASC
   ...> LIMIT 60;
api_access_datetime         time                         strike  call_gamma_oi  call_gamma_vol  put_gamma_oi  put_gamma_vol
--------------------------  ---------------------------  ------  -------------  --------------  ------------  -------------
2025-10-22T12:50:09.013497  2025-10-22T17:49:41.000000Z  410.0   22626621.83    2320998.71      -34207948.32  -19803343.2  
2025-10-22T12:50:09.013502  2025-10-22T17:49:41.000000Z  412.5   865264.93      496656.13       -3525772.58   -4764364.24  
2025-10-22T12:50:09.013506  2025-10-22T17:49:41.000000Z  415.0   26139804.19    2571426.18      -18842957.9   -12416678.11 
2025-10-22T12:50:09.013510  2025-10-22T17:49:41.000000Z  417.5   972748.02      2463919.81      -4191245.58   -4659839.29  
2025-10-22T12:50:09.013513  2025-10-22T17:49:41.000000Z  420.0   43395267.89    9789352.63      -77556801.26  -37289892.67 
2025-10-22T12:50:09.013519  2025-10-22T17:49:41.000000Z  422.5   1973511.72     1844760.47      -4182709.09   -7378619.2   
2025-10-22T12:50:09.013523  2025-10-22T17:49:41.000000Z  425.0   22648161.55    7425317.19      -22248071.08  -17451348.41 
2025-10-22T12:50:09.013527  2025-10-22T17:49:41.000000Z  427.5   3457113.05     2291848.64      -4610760.4    -6439397.77  
2025-10-22T12:50:09.013532  2025-10-22T17:49:41.000000Z  430.0   37251414.51    28001141.66     -49423509.87  -44376661.79 
2025-10-22T12:50:09.013539  2025-10-22T17:49:41.000000Z  432.5   4919370.24     12277164.05     -5297928.74   -27612216.6  
2025-10-22T12:50:09.013542  2025-10-22T17:49:41.000000Z  435.0   22340799.34    40774227.08     -22645052.06  -46522980.94 
2025-10-22T12:50:09.013546  2025-10-22T17:49:41.000000Z  437.5   7342034.63     22464407.07     -5398073.2    -17549524.16 
2025-10-22T12:50:09.013550  2025-10-22T17:49:41.000000Z  440.0   59132950.46    63629001.31     -33283769.54  -51498300.6  
2025-10-22T12:50:09.013575  2025-10-22T17:49:41.000000Z  442.5   12547479.16    30570186.88     -6048766.63   -14540066.15 
2025-10-22T12:50:09.013580  2025-10-22T17:49:41.000000Z  445.0   30018917.1     36215384.21     -15172449.29  -12118852.82 
2025-10-22T12:50:09.013584  2025-10-22T17:49:41.000000Z  447.5   18868342.71    14275272.31     -5449956.55   -2436312.66  
2025-10-22T12:50:09.013590  2025-10-22T17:49:41.000000Z  450.0   101896509.65   52802053.62     -28409646.32  -10739952.4  
2025-10-22T12:51:14.183511  2025-10-22T17:50:41.000000Z  410.0   23235799.31    2438529.57      -33556193.23  -19373535.7  
2025-10-22T12:51:14.183515  2025-10-22T17:50:41.000000Z  412.5   906919.52      522584.18       -3438478.85   -4647542.76  
2025-10-22T12:51:14.183519  2025-10-22T17:50:41.000000Z  415.0   27022785.58    2706166.91      -18336248.13  -12104521.35 
2025-10-22T12:51:14.183522  2025-10-22T17:50:41.000000Z  417.5   1020709.72     2596875.48      -4063357.96   -4517677.22  
2025-10-22T12:51:14.183526  2025-10-22T17:50:41.000000Z  420.0   44290671.84    10307686.07     -75403900.07  -36046163.4  
2025-10-22T12:51:14.183530  2025-10-22T17:50:41.000000Z  422.5   2067488.13     1937719.46      -4023333.08   -7102267.69  
2025-10-22T12:51:14.183533  2025-10-22T17:50:41.000000Z  425.0   23455927.49    7875387.76      -21456768.22  -16748933.52 
2025-10-22T12:51:14.183537  2025-10-22T17:50:41.000000Z  427.5   3596267.1      2391897.84      -4431477.24   -6192049.12  
2025-10-22T12:51:14.183541  2025-10-22T17:50:41.000000Z  430.0   38068124.4     29183638.67     -47987105.81  -42744910.41 
2025-10-22T12:51:14.183544  2025-10-22T17:50:41.000000Z  432.5   5091345.57     12749942.12     -5078211.62   -26511737.37 
2025-10-22T12:51:14.183548  2025-10-22T17:50:41.000000Z  435.0   22952614.29    42168869.88     -21791637.82  -44462795.11 
2025-10-22T12:51:14.183552  2025-10-22T17:50:41.000000Z  437.5   7530769.01     23097437.39     -5122031.69   -16637070.56 
2025-10-22T12:51:14.183556  2025-10-22T17:50:41.000000Z  440.0   60148177.41    65457460.69     -31959665.73  -48773044.74 
2025-10-22T12:51:14.183561  2025-10-22T17:50:41.000000Z  442.5   12854118.63    31326947.31     -5719612.56   -13732624.86 
2025-10-22T12:51:14.183567  2025-10-22T17:50:41.000000Z  445.0   30642480.22    37050781.46     -14466523.2   -11450151.17 
2025-10-22T12:51:14.183573  2025-10-22T17:50:41.000000Z  447.5   19288556.42    14593749.36     -5159697.15   -2307318.16  
2025-10-22T12:51:14.183576  2025-10-22T17:50:41.000000Z  450.0   103271745.1    54147262.96     -27396703.44  -10201664.92 
2025-10-22T12:52:14.437937  2025-10-22T17:51:41.000000Z  417.5   1024308.2      2607022.98      -4065743.74   -4534134.72  
2025-10-22T12:52:14.437941  2025-10-22T17:51:41.000000Z  422.5   2072295.61     1942926.63      -4019772.76   -7096319.03  
2025-10-22T12:52:14.437944  2025-10-22T17:51:41.000000Z  447.5   19126833.07    14486022.91     -5111660.91   -2287813.99  
2025-10-22T12:52:14.437486  2025-10-22T17:52:11.000000Z  410.0   23315143.13    2453094.42      -33495212.37  -19388141.4  
2025-10-22T12:52:14.437489  2025-10-22T17:52:11.000000Z  412.5   910223.42      524115.78       -3435155.75   -4647946.48  
2025-10-22T12:52:14.437493  2025-10-22T17:52:11.000000Z  415.0   27048181.51    2713674.49      -18313484.37  -12103743.36 
2025-10-22T12:52:14.437497  2025-10-22T17:52:11.000000Z  420.0   44319236.11    10359106.58     -75245964.53  -35991478.32 
2025-10-22T12:52:14.437501  2025-10-22T17:52:11.000000Z  425.0   23407419.59    7859719.07      -21419107.49  -16769440.72 
2025-10-22T12:52:14.437504  2025-10-22T17:52:11.000000Z  427.5   3590763.79     2400047.3       -4436028.1    -6239880.4   
2025-10-22T12:52:14.437508  2025-10-22T17:52:11.000000Z  430.0   37973908.72    29139540.07     -47764839.66  -43160062.37 
2025-10-22T12:52:14.437512  2025-10-22T17:52:11.000000Z  432.5   5063656.94     12774407.58     -5046011.77   -26532887.77 
2025-10-22T12:52:14.437516  2025-10-22T17:52:11.000000Z  435.0   22778280.54    41735609.1      -21630374.32  -44085010.38 
2025-10-22T12:52:14.437519  2025-10-22T17:52:11.000000Z  437.5   7462856.56     22915910.6      -5090560.41   -16539093.91 
2025-10-22T12:52:14.437523  2025-10-22T17:52:11.000000Z  440.0   59820629.83    65034072.54     -31744171.19  -48539218.89 
2025-10-22T12:52:14.437527  2025-10-22T17:52:11.000000Z  442.5   12763826.44    31108115.0      -5669962.18   -13614065.61 
2025-10-22T12:52:14.437530  2025-10-22T17:52:11.000000Z  445.0   30411315.19    36744754.12     -14331746.48  -11354539.36 
2025-10-22T12:52:14.437534  2025-10-22T17:52:11.000000Z  450.0   102657867.42   53998769.42     -27165944.27  -10148036.51 
... more results etc.
```

